# Текущий контекст

## Дата последнего обновления
2026-02-09

## Текущий фокус
Последний коммит: `dcbe395` - "security: add rate limiting, CORS protection, and error handling"

### Завершенные задачи
✅ Добавлен rate limiting (30 req/min для чата, 10 req/min для анализа)
✅ Добавлена CORS защита с валидацией origin
✅ Добавлен retry logic для Gemini API (3 попытки с exponential backoff)
✅ Удалены console.log из production кода
✅ Исправлена генерация ID сообщений на crypto.randomUUID()
✅ Создан API endpoint для удаления фотоанализов
✅ Унифицированы лимиты изображений (5MB)
✅ Создана единая функция для получения профиля пользователя

### Текущие приоритеты
1. **Стабилизация** - проект в состоянии MVP, основной функционал работает
2. **Мониторинг** - необходимо настроить мониторинг ошибок (Sentry)
3. **Тестирование** - добавить тесты для критических компонентов
4. **Документация** - обновить README с актуальной информацией

### Активные решения
- Используем in-memory rate limiting (для production рекомендуется Redis)
- CORS разрешает только localhost и NEXT_PUBLIC_SITE_URL
- PHI данные (фото кожи) хранятся без дополнительного шифрования (только Supabase encryption at rest)
- Типы Supabase не полностью синхронизированы с БД (используем @ts-expect-error)

### Блокеры/Риски
- Нет автоматических тестов
- Нет мониторинга ошибок
- Нет бэкапов базы данных
- TypeScript типы Supabase могут устареть при изменении схемы БД

## Следующие шаги
1. Добавить Sentry для мониторинга ошибок
2. Настроить автоматические бэкапы Supabase
3. Добавить unit-тесты для API endpoints
4. Добавить E2E тесты для критических пользовательских сценариев
